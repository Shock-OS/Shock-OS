#!/bin/bash

shading_type="$(dconf read /org/mate/desktop/background/color-shading-type)"

if [[ "$shading_type" == "'solid'" ]]
then

    shading_type='Solid!Horizontal Gradient!Vertical Gradient'

elif [[ "$shading_type" == "'horizontal-gradient'" ]]
then

    shading_type='Solid!^Horizontal Gradient!Vertical Gradient'

else

    shading_type='Solid!Horizontal Gradient!^Vertical Gradient'

fi

output="$(yad --window-icon=preferences-desktop-wallpaper --title="Background Colors" --form --field="Shading Type:":CB "$shading_type" --field="Choose Primary Color":FBTN 'bash -c "echo primary_color=\$(eval \"yad --window-icon=preferences-desktop-wallpaper --title=Primary\ Color --color --gtk-palette --expand-palette --init-color=\$(dconf read /org/mate/desktop/background/primary-color)\")"' --field="Choose Secondary Color":FBTN 'bash -c "echo secondary_color=\$(eval \"yad --window-icon=preferences-desktop-wallpaper --title=Secondary\ Color --color --gtk-palette --expand-palette --init-color=\$(dconf read /org/mate/desktop/background/secondary-color)\")"' --button="Reset to Default"\!edit-undo:1 --button="Apply"\!gtk-ok:0)"

ex=$?

if ((ex==1)) #reset to default
then

    dconf reset /org/mate/desktop/background/color-shading-type

    dconf reset /org/mate/desktop/background/primary-color

    dconf reset /org/mate/desktop/background/secondary-color

elif ((ex==0)) #apply
then

    shading_type="$(echo "$output" | grep '|')"

    shading_type="${shading_type%%|*}"

    shading_type=$(echo "$shading_type" | awk '{print tolower($0)}') #this command makes all the letters lowercase

    shading_type="${shading_type// /-}" #this command replaces all the spaces with hyphens

    eval "$output" #errors produced by this command are healthy errors

    dconf write /org/mate/desktop/background/color-shading-type "'$shading_type'"

    if [[ -n "$primary_color" ]]
    then

        dconf write /org/mate/desktop/background/primary-color "'$primary_color'"

    fi

    if [[ -n "$secondary_color" ]]
    then

        dconf write /org/mate/desktop/background/secondary-color "'$secondary_color'"

    fi

fi
