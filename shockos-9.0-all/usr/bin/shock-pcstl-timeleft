#!/bin/bash

#check how much screen time is left

while true
do

    if [[ ! -d /usr/share/shock-pcstl/"$(whoami)" ]]
    then

        yad --window-icon=/usr/share/shock/parental-controls.png --image=changes-allow --title="Screen Time Limit" --text="Your screen time limit has been removed." --button="Dismiss"\!gtk-quit

        exit

    else

        minutes=$(cat /usr/share/shock-pcstl/"$(whoami)"/shock-screen-time-limit)

        total_hours=$((minutes/60))

        total_minutes=$((minutes%60))

        if ((total_hours>0))
        then

            if ((total_minutes>0))
            then

                total_display="$total_hours hours and $total_minutes minutes"

            else

                total_display="$total_hours hours"

            fi

        else

            total_display="$total_minutes minutes"

        fi

        remaining="$(cat /usr/share/shock-pcstl/"$(whoami)"/today/"$(date "+%F")")"

        remaining_hours=$((remaining/60))

        remaining_minutes=$((remaining%60))

        if ((remaining_hours>0))
        then

            if ((remaining_minutes>0))
            then

                remaining_display="$remaining_hours hours and $remaining_minutes minutes"

            else

                remaining_display="$remaining_hours hours"

            fi

        elif ((remaining_minutes>1))
        then

            remaining_display="$remaining_minutes minutes"

        else

            remaining_display="1 minute"

        fi

        yad --window-icon=/usr/share/shock/parental-controls.png --title="Screen Time Limit" --text="Your parent/guardian/administrator has set a daily screen time limit on your profile.

Total daily limit: $total_display

Time remaining: $remaining_display" --buttons-layout=edge --button="Refresh"\!gtk-refresh --button="Dismiss"\!gtk-quit

        ex=$?

        if [[ "$ex" != "0" ]]
        then

            exit

        fi

    fi

done
