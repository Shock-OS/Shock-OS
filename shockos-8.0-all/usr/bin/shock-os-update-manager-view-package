#!/bin/bash

package="$2"

type="$3"

#THE LOADING FUNCTIONS BEGIN

function start_loading() {

yad --window-icon=system-software-update --title="Shockware Center" --progress-text="Loading app info..." --center --progress --pulsate --auto-close --undecorated --no-buttons & killpid=$!

}

function end_loading() {

kill -9 $killpid

}

#THE LOADING FUNCTIONS END

start_loading

if [[ "$type" == "A" ]] #if APT package
then

	details="$(apt show $package)"

	description="$(echo "$details" | grep -A10 Description:)"

	version="$(echo "$details" | grep Version:)"

	size="$(echo "$details" | grep Size:)"

	tmpfile="$(mktemp)"

	echo "$description

	$version

	$size" | tee "$tmpfile"

	icon="$(find /var/lib/app-info/icons/*/*/"$package"_* | head -1)"

	if [[ -z "$icon" ]]
	then

		icon="/usr/share/shock-os-update-manager/apt.svg"

	fi

	end_loading

	yad --window-icon=system-software-update --title="Details of $package" --text="APT package" --width=400 --height=300 --image="$icon" --text-info --filename="$tmpfile" --button="Close"\!gtk-close

	ex=$?

	rm "$tmpfile"

else #if Flatpak

	icon="$4"

	id="$(basename "$4")"

	id="${id::-4}"

	description="$(flatpak search "$id" --columns=app,description | grep "^$id" | awk -F '\t' '{print $2}' | head -n1)"

	version="$(flatpak search "$id" --columns=app,version | grep "^$id" | awk -F '\t' '{print $2}' | head -n1)"

	tmpfile="$(mktemp)"

	echo " Description: $description

Version: $version" | tee "$tmpfile"

	end_loading

	yad --window-icon=system-software-update --title="Details of $package" --text="Flatpak application" --width=400 --height=300 --image="$icon" --text-info --filename="$tmpfile" --button="Close"\!gtk-close

	ex=$?

	rm "$tmpfile"

fi

	

