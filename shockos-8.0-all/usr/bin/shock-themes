#!/bin/bash

while true
do

	yadlist="start-here \"Default Shock OS theme, icon and cursor pack\" Default"

	if (($(ls ~/.themes | wc -l)>0))
	then

		for i in ~/.themes/* #list all themes
		do

			yadlist+=" gnome-settings-theme \"Theme pack\" \"$(basename "$i")\" "

		done

	fi

	for i in ~/.icons/* #list all 2-in-1 icons and cursor packs
	do

		if  [[ "$(basename "$(find "$i" -name "places" | head -1)")" == "places" ]] && [[ -d "$i/cursors" ]]
		then

			yadlist+=" folder-images \"Icon pack with cursors\" \"$(basename "$i")\" "

		fi

	done

	for i in ~/.icons/* #list all icons
	do

		if  [[ "$(basename "$(find "$i" -name "places" | head -1)")" == "places" ]] && [[ ! -d "$i/cursors" ]]
		then

			yadlist+=" folder-images \"Icon pack\" \"$(basename "$i")\" "

		fi

	done

	for i in ~/.icons/* #list all cursors
	do

		if  [[ -d "$i/cursors" ]] && [[ "$(basename "$(find "$i" -name "places" | head -1)")" != "places" ]]
		then

			yadlist+=" input-mouse \"Cursor pack\" \"$(basename "$i")\" "

		fi

	done

	yad="yad --window-icon=gnome-settings-theme --title=\"Themes\" --text=\"Install, remove, rename or use themes, icons and cursors.\" --list --column=\"Type\":IMG --column=ToolTip:HD --column=Name --tooltip-column=2 --always-print-result --search-column=3 --response=3 --height=300 --buttons-layout=spread --button=\"Install\"\!add --button=\"Remove\"\!remove --button=\"Rename\"\!gtk-edit --button=\"Use\"\!dialog-ok $(echo "$yadlist")"

	output="$(eval $yad)"

	ex=$?

	name=$(echo $output | awk 'BEGIN {FS="|" } { print $3 }')

	type=$(echo $output | awk 'BEGIN {FS="|" } { print $2 }')

	if [[ "$ex" == "0" ]] #install
	then

		cd ~/

		file="$(yad --window-icon=gnome-settings-theme --title="Install" --text="Please select a theme, icon or cursor pack to install. You may select a folder or a compressed archive." --file --button="Install"\!document-open)"

		ex=$?

		if [[ "$ex" == "0" ]]
		then

			mkdir -p /tmp/shock_themes/$(whoami)/"$(basename "$file")"

			cd /tmp/shock_themes/$(whoami)/"$(basename "$file")"

			if [[ -f "$file" ]] #if archive, then extract archive
			then

				unp -f "$file"

			else #if folder

				cp -r "$file" .

				cd "$(dirname $(find "/tmp/shock_themes/$(whoami)/$(basename "$file")" -name index.theme))"

				cd ..

			fi

			#cd ..

			for i in *
			do

				if [[ -e "$i/index.theme" ]]
				then

					if [[ -d "$i/status" ]] || [[ -d "$i/places" ]]
					then

						directories=($(cat "$i/index.theme" | grep places | grep -oP "\[([^]]+)\]"))

						directories+=($(cat "$i/index.theme" | grep status | grep -oP "\[([^]]+)\]"))

						for a in "${directories[@]}"
						do

							if [[ "$a" == *"scalable"* ]]
							then

								cp -rf /usr/share/shock-themes/scalable/* "$i/${a:1:${#a}-2}"

							elif [[ "$a" == *"symbolic"* ]]
							then

								cp -rf /usr/share/shock-themes/symbolic/* "$i/${a:1:${#a}-2}"

							else

								cp -rf "/usr/share/shock-themes/$(echo "$a" | grep -oE '[0-9]+' | head -n 1)"/* "$i/${a:1:${#a}-2}"

							fi

						done

						cp -r "$i" ~/.icons

					else

						cp -r "$i" ~/.themes

					fi

				fi

			done

			rm -r /tmp/shock_themes/$(whoami)/"$(basename "$file")"

		fi

	elif [[ "$ex" == "1" ]] #remove
	then

		if [[ "$type" == "Theme pack" ]] #if theme pack
		then

			rm -r ~/.themes/"$name"

		else #if icon or cursor pack

			rm -r ~/.icons/"$name"

		fi

	elif [[ "$ex" == "2" ]] #rename
	then

		success="no"

		until [[ "$success" == "yes" ]]
		do

			newname="$(yad --window-icon=gnome-settings-theme --title="Rename" --text="Please enter the new name for your theme pack." --entry --entry-text="$name" --button="Rename")"

			ex=$?

			if [[ "$ex" == "0" ]]
			then

				success="yes"

				if [[ "$type" == "Theme pack" ]] #if theme pack
				then

					if [[ -e ~/.themes/"$newname" ]] #if theme with that name already exists
					then

						yad --window-icon=gnome-settings-theme --image=emblem-important --title="Rename" --text="There is already a theme pack named '$newname'. Please choose a different name." --button="Retry"

						success="no"

					else

						mv ~/.themes/"$name" ~/.themes/"$newname"

						if [[ "$(cat ~/.config/shock-themes-gtk-theme)" == "$name" ]]
						then

							dconf write /org/mate/desktop/interface/gtk-theme "'$newname'"

							dconf write /org/mate/marco/general/theme "'$newname'"

							echo "$newname" | tee ~/.config/shock-themes-gtk-theme

						fi

					fi

				else #if icon or cursor pack

					if [[ -e ~/.icons/"$newname" ]] #if icon or cursor pack with that name already exists
					then

						yad --window-icon=gnome-settings-theme --image=emblem-important --title="Rename" --text="There is already an icon/cursor pack named '$newname'. Please choose a different name." --button="Retry"

						success="no"

					else

						mv ~/.icons/"$name" ~/.icons/"$newname"

						if [[ "$(cat ~/.config/shock-themes-icon-theme)" == "$name" ]]
						then

							dconf write /org/mate/desktop/interface/icon-theme "'$newname'"

							echo "$newname" | tee ~/.config/shock-themes-icon-theme

						fi

						if [[ "$(cat ~/.config/shock-themes-mouse-theme)" == "$name" ]]
						then

							dconf write /org/mate/desktop/peripherals/mouse/cursor-theme "'$newname'"

							echo "$newname" | tee ~/.config/shock-themes-mouse-theme

						fi

					fi

				fi

			fi

		done

	elif [[ "$ex" == "3" ]] #use
	then

		if [[ "$type" == "Default Shock OS theme, icon and cursor pack" ]]
		then

			if ! [[ -f ~/.config/shock_themes ]]
			then

				touch ~/.config/shock_themes

				echo 'lod=light
color=blue' | tee ~/.config/shock_themes

			fi

			eval "$(cat ~/.config/shock_themes)"

			if [[ "$lod" == "light" ]]
			then

				theme_selection='^Light!Dark'

			elif [[ "$lod" == "dark" ]]
			then

				theme_selection='Light!^Dark'

			fi

			if [[ "$color" == "blue" ]]
			then

				color_selection='^Blue!Green!Orange!Pink!Purple!Red!Yellow'

			elif [[ "$color" == "green" ]]
			then

				color_selection='Blue!^Green!Orange!Pink!Purple!Red!Yellow'

			elif [[ "$color" == "orange" ]]
			then

				color_selection='Blue!Green!^Orange!Pink!Purple!Red!Yellow'

			elif [[ "$color" == "pink" ]]
			then

				color_selection='Blue!Green!Orange!^Pink!Purple!Red!Yellow'

			elif [[ "$color" == "purple" ]]
			then

				color_selection='Blue!Green!Orange!Pink!^Purple!Red!Yellow'

			elif [[ "$color" == "red" ]]
			then

				color_selection='Blue!Green!Orange!Pink!Purple!^Red!Yellow'

			elif [[ "$color" == "yellow" ]]
			then

				color_selection='Blue!Green!Orange!Pink!Purple!Red!^Yellow'

			fi

			output=$(yad --width=300 --window-icon=gnome-settings-theme --title="Themes" --form --field="Theme:":CB "$theme_selection" --field="Color:":CB "$color_selection" --button="Apply")

			ex=$?

			if [[ "$ex" == "0" ]]
			then

				lod=$(echo "$output" | awk -F'|' '{print $1}')

				lod=$(echo "$lod" | awk '{print tolower($0)}') #this command makes all the letters lowercase

				color=$(echo "$output" | awk -F'|' '{print $2}')

				color=$(echo "$color" | awk '{print tolower($0)}') #this command makes all the letters lowercase

				theme="shock-$lod-$color"

				dconf write /org/mate/desktop/interface/gtk-theme "'$theme'"

				dconf write /org/mate/marco/general/theme "'$theme'"

				dconf write /org/mate/desktop/interface/icon-theme "'$theme'"

				dconf write /org/mate/desktop/peripherals/mouse/cursor-theme "'mate-black'"

				echo "[Greeter]
theme-name=shock-dark-$color
icon-theme-name=shock-dark-$color
show-hostname=false
show-power=false
show-keyboard=false
show-clock=false" > /etc/lightdm/slick-greeter.conf

				echo "lod=$lod
color=$color" | tee ~/.config/shock_themes

			fi

		elif [[ "$type" == "Theme pack" ]]
		then

			dconf write /org/mate/desktop/interface/gtk-theme "'$name'"

			dconf write /org/mate/marco/general/theme "'$name'"

			echo "$name" | tee ~/.config/shock-themes-gtk-theme

		elif [[ "$type" == "Icon pack" ]]
		then

			dconf write /org/mate/desktop/interface/icon-theme "'$name'"

			echo "$name" | tee ~/.config/shock-themes-icon-theme

		elif [[ "$type" == "Cursor pack" ]]
		then

			dconf write /org/mate/desktop/peripherals/mouse/cursor-theme "'$name'"

			echo "$name" | tee ~/.config/shock-themes-mouse-theme

		elif [[ "$type" == "Icon pack with cursors" ]]
		then

			yad --window-icon=gnome-settings-theme --title="Icon Pack with Cursors" --text="The icon pack '$name' also contains cursors. Would you like to use the icons, the cursors, or both?" --button="Icons Only" --button="Cursors Only" --button="Both"

			ex=$?

			if [[ "$ex" == "0" ]] #icons only
			then

				dconf write /org/mate/desktop/interface/icon-theme "'$name'"

				echo "$name" | tee ~/.config/shock-themes-icon-theme

			elif [[ "$ex" == "1" ]] #cursors only
			then

				dconf write /org/mate/desktop/peripherals/mouse/cursor-theme "'$name'"

				echo "$name" | tee ~/.config/shock-themes-mouse-theme

			elif [[ "$ex" == "2" ]] #both
			then

				dconf write /org/mate/desktop/interface/icon-theme "'$name'"

				echo "$name" | tee ~/.config/shock-themes-icon-theme

				dconf write /org/mate/desktop/peripherals/mouse/cursor-theme "'$name'"

				echo "$name" | tee ~/.config/shock-themes-mouse-theme

			fi

		fi

	else

		exit

	fi

done












