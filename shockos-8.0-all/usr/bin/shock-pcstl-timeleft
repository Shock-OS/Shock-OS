#!/bin/bash

#check how much screen time is left

while true
do

    if [[ ! -d /usr/share/shock-pcstl/"$(whoami)" ]]
    then

        yad --window-icon=/usr/share/shock/parental-controls.png --image=changes-allow --title="Screen Time Limit" --text="Your screen time limit has been removed." --button="Dismiss"\!gtk-quit

        exit

    else

        minutes=$(cat /usr/share/shock-pcstl/"$(whoami)"/shock-screen-time-limit)

        remaining="$(cat /usr/share/shock-pcstl/"$(whoami)"/today/"$(date "+%F")") minutes"

        if [[ "$remaining" == "1 minutes" ]]
        then

            remaining="1 minute"

        elif [[ "$remaining" == " minutes" ]] #if the screen time limit has changed less then 60 seconds ago and shock-pcstl-daemon has not adjusted yet
        then

            remaining="$minutes minutes"

        fi

        yad --window-icon=/usr/share/shock/parental-controls.png --title="Screen Time Limit" --text="Your parent/guardian/administrator has set a daily screen time limit on your profile.

Total daily limit: $minutes minutes

Time remaining: $remaining" --buttons-layout=edge --button="Refresh"\!gtk-refresh --button="Dismiss"\!gtk-quit

        ex=$?

        if [[ "$ex" != "0" ]]
        then

            exit

        fi

    fi

done
