#!/bin/bash

IFS=$'\n'

#this script is designed to shuffle between backgrounds when the user has set a slideshow background

if [[ -f ~/.config/shock/slideshow-background ]]
then

    source ~/.config/shock/slideshow-background

    current_background="$(gsettings get org.mate.background picture-filename)"

    backgrounds=("$directory"/*)

    if [[ "$random_boolean" == "FALSE" ]] #if in order, set the counter to the current backdrop
    then

        counter=0

        images_in_directory=$(ls "$directory" | wc -l)

        until [[ "${backgrounds[counter]}" == "$current_background" ]] || ((counter>images_in_directory))
        do

            counter=$((counter+1))

        done

        if ((counter>images_in_directory))
        then

            counter=0

        fi

    fi

    while true
    do

        sleep $((delay*60))

        backgrounds=("$directory"/*)

        images_in_directory=$(ls "$directory" | wc -l)

        until [[ "$(file "$background")" == *"image"* ]] && [[ "$background" != "$current_background" ]]
        do

            if [[ "$random_boolean" == "TRUE" ]] #shuffle randomly
            then

                background="$(ls "$directory"/* | shuf -n 1)"

            else #shuffle in order

                if ((counter<$images_in_directory))
                then

                    counter=$((counter+1))

                else

                    counter=0

                fi

                background="${backgrounds[counter]}"

            fi

        done

        gsettings set org.mate.background picture-filename "$background"

        current_background="$background"

    done

fi

