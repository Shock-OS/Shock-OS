#!/bin/bash

IFS=$'\n'

counter=1

app_name=""

icon=""

title=""

text=""

yad_list=()

if [[ "$(gsettings get org.mate.NotificationDaemon do-not-disturb)" == "true" ]]
then

    dnd_icon="--button=\"Do Not Disturb ON\"\!notifications-disabled-symbolic"

    dnd="TRUE"

else

    lines=$(cat ~/.cache/shock-tmp/notifications-log | wc -l)

    for line_num in $(seq 1 $lines)
    do

        line="$(sed -n "$line_num"p ~/.cache/shock-tmp/notifications-log)"

        if [[ "$counter" == "1" ]]
        then

            app_name="$line"

        elif [[ "$counter" == "2" ]]
        then

            icon="$line"

        elif [[ "$counter" == "3" ]]
        then

            title="$line"

        elif [[ "$counter" == "4" ]]
        then

            text="$line"

        else #if separator line

            if [[ -z "$icon" ]]
            then

                icon="info"

            fi

            yad_list+=("\"$icon\"" "\"<b>${title}</b>
    $text\"")

            app_name=""

            icon=""

            title=""

            text=""

            counter=0

        fi

        counter=$((counter+1))

    done

    dnd_button="--button=\"Do Not Disturb OFF\"\!preferences-system-notifications-symbolic"

    dnd="FALSE"

fi

# Get the screen dimensions
screen_width=$(xrandr --current | grep '*' | uniq | awk '{print $1}' | cut -d 'x' -f1)

screen_height=$(xrandr --current | grep '*' | uniq | awk '{print $1}' | cut -d 'x' -f2)

# Set the window width and height
window_width=200

window_height=$((${#yad_list[@]}/2*50+100))

if ((window_height>screen_height))
then

    window_height=$((screen_height-100))

fi

# Calculate the position
posx=$((screen_width-window_width))

posy=$((screen_height-window_height))

# Launch YAD with the specified position
eval "yad --width=$window_width --height=$window_height --posx=$posx --posy=$posy --fixed --undecorated --skip-taskbar --close-on-unfocus --list --no-click --dclick-action=\"\" --column=\"Icon\":IMG --column=\"Text\" ${yad_list[@]} --buttons-layout=edge $dnd_button --button=\"Clear All\"\!edit-clear-all-symbolic"

ex=$?

if [[ "$ex" == "0" ]] #toggle Do Not Disturb
then

    if [[ "$dnd" == "TRUE" ]]
    then

        gsettings set org.mate.NotificationDaemon do-not-disturb "true"

    else

        gsettings set org.mate.NotificationDaemon do-not-disturb "true"

    fi

elif [[ "$ex" == "1" ]] #Clear All
then

    rm ~/.cache/shock-tmp/notifications-log

fi

    



