#!/bin/bash

#the authentication element begins

SAE_PC="5555"

SAE_ATTEMPTS=1

SAE_PROGRAM_NAME="Automatic Updates"

until [[ "$SAE_PC" == "0" ]]        
do

    if [[ $SAE_ATTEMPTS == 1 ]]
    then

        SAE_PASSWORD=$(yad --window-icon=changes-prevent --title="Authentication" --text="$SAE_PROGRAM_NAME requires your password to continue." --entry --hide-text --text-align=center --width=400 --button="Cancel":1 --button="Authenticate":0)
    
    else

        SAE_PASSWORD=$(yad --window-icon=changes-prevent --title="Authentication" --text="The password you entered was incorrect. Please try again." --entry --hide-text --text-align=center --width=400 --button="Cancel":1 --button="Authenticate":0)

    fi
    
    SAE_QUIT=$?

    if [[ "$SAE_QUIT" != "0" ]]
    then

        exit

    fi

    echo "$SAE_PASSWORD" | sudo -S echo "PERMISSION GRANTED"

    SAE_PC=$?

    SAE_PASSWORD=""

    let SAE_ATTEMPTS++

done

#the authentication element ends

if [[ -f /etc/sudoers.d/shock_automatic_updates ]]
then

    yad --window-icon=emblem-synchronizing --title="Automatic Updates" --text="Automatic updates are already enabled. Would you like to disable automatic updates?" --button="Disable Automatic Updates" --button="Cancel"

    dau=$?

    if [[ "$dau" == "0" ]]
    then

        sudo rm /etc/sudoers.d/shock_automatic_updates

        yad --window-icon=emblem-synchronizing --title="Automatic Updates" --text="Automatic updates have been disabled." --button="Dismiss"

    fi

else

    yad --window-icon=emblem-synchronizing --width=700 --title="Automatic Updates" --text="Automatic updates are run as root daily if the internet connection is stable. You will not be able to install or remove APT packages while automatic updates are being applied. You will also not be able to shutdown or logout while automatic updates are being applied. Would you like to enable automatic updates?" --button="Enable Automatic Updates" --button="Cancel"

    eau=$?

    if [[ "$eau" != "0" ]]
    then

        exit

    fi

    sudo echo '# Allow any user to run automatic updates without requiring a password

%sudo ALL = NOPASSWD:/usr/bin/shock-auto-updates' | sudo EDITOR='tee' visudo -f /etc/sudoers.d/shock_automatic_updates

    yad --window-icon=emblem-synchronizing --title="Automatic Updates" --text="Automatic updates are now enabled and will be run as root on a daily basis." --button="Dismiss"

fi






    
