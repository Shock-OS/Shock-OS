#!/bin/bash

if [[ -f ~/.shock_kidprofile ]] #if kid profile
then

    exit

fi

while true
do

    sudo shock-os-update-manager-refresh

    if [[ "$(apt list --upgradable)" == *"upgradable"* ]]
    then

        if [[ -f /etc/sudoers.d/shock_automatic_updates ]]
        then

            shock-auto-updates-kickstart

            sudo shock-os-update-manager-refresh

            if [[ "$(apt list --upgradable)" != *"upgradable"* ]]
            then

                shock-release-upgrader

            fi

        else

            if [[ "$(apt-get -q -y --ignore-hold --allow-change-held-packages --allow-unauthenticated -s dist-upgrade | /bin/grep  ^Inst | wc -l)" == "1" ]]
            then

                yad --notification --image=system-software-update --text="1 update is available."

            else

                yad --notification --image=system-software-update --text="$(apt-get -q -y --ignore-hold --allow-change-held-packages --allow-unauthenticated -s dist-upgrade | /bin/grep  ^Inst | wc -l) updates are available."

            fi

            pi-gpk-update-viewer

            sudo shock-os-update-manager-refresh

            if [[ "$(apt list --upgradable)" != *"upgradable"* ]]
            then

                shock-release-upgrader

            fi

        fi

    else

        shock-release-upgrader

    fi

    sleep 900

done
