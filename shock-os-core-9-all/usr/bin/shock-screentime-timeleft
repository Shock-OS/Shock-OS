#!/bin/bash

runuser="$(whoami)"

while true
do

    current_date="$(date +%F)"

    total_minutes=$(cat /usr/share/shock-screentime/"$runuser"/dailylimit)

    total_minutes_display="$(shock-ss-pretty-time $total_minutes)"

    if [[ -f /usr/share/shock-screentime/"$runuser"/today-limit/"$current_date" ]] #if user logged in less than a minute ago for the first time today
    then

        used_minutes=$(cat /usr/share/shock-screentime/"$runuser"/today-limit/"$current_date")

    else

        used_minutes=0

    fi

    remaining_minutes=$((total_minutes-used_minutes))

    remaining_minutes_display="$(shock-ss-pretty-time $remaining_minutes)"

    percentage=$(echo "scale=0; ($remaining_minutes * 100) / $total_minutes" | bc)

    echo "$percentage"

    echo "#${remaining_minutes_display} remaining"

    sleep 30

done | yad --window-icon=shock-screentime --title="Screen Time Limit" --text="Your parent/guardian/administrator has set a daily screen time limit of $total_minutes_display on your profile." --progress --button="Dismiss"\!gtk-cancel






